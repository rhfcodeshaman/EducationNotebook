#note
# Subject Overview
- The downside to traditional VMs is that the virtualization layer is heavy and redundant
- With docker you can package an app and dependencies into a single immutable artifact
- This enables you to run different app versions with different dependencies simultaneously
- Microservice architecture is one of the things driving the popularity of containers

## Docker Basics
- There are three key components in the Docker ecosystem
	- Dockerfile: a text file containing instructions(commands) to build a Docker image.
	- Docker Image: A snapshot of a container, created from a Dockerfile. Images are storied in a registry, like Docker Hub or Harbor, and can be pulled or pushed to the registry.
	- Docker Container: A running instance of a Docker image.
### Docker Commands
**Commonly used Docker commands:**
Download an image from a registry.
```
docker pull <image>
```

Build an image from a Dockerfile, where (path) is  the directory containing the Dockerfile.
```
docker build -t <image_name> <path>
```

List all images available on your local machine.
```
docker image ls
```

Run a container from an image, mapping host ports to container ports. `-d` is detached(runs in the background) and `-p` is publish a container's port(s) to the host, alternatively `--publish`.
```
docker run -d -p <host_post>:<container_port> --name <container_name> <image>
```

List all running containers.
```
docker coontainer ls
```

Stop a running container.
```
docker container stop <container>
```

Remove a stopped container.
```
docker container rm <container>
```

Remove an image from your local machine.
```
docker image rm <image>
```

## Data Persistence
[Docker Storage Documentation](https://docs.docker.com/engine/storage/)
### Volumes
- Volumes are persistent data stores for containers, created and managed by Docker. You can create a volume explicitly using the `docker voluem create` command or Docker can create a volume during container or service creation.
- A volume creates a new directory within Docker's storage directory on the host machine, and Docker manages that directory's contents.
- **When to use volumes**:
	- Volumes are the preferred mechanism for persisting data generated by and used by Docker containers as they are completely managed by Docker
	- They are easier to back up or migrate than bind mounts
	- You can manage them using Docker CLI commands or the Docker API
	- They work on both Linux and Windows containers
	- They can be more safely shared among multiple containers
	- New volumes have their content pre-populated by a container o rbuild
	- They are great when your application require high-performance input/output
- **They are not a good choice when**:
	- You need to access files from the host
### Bind Mounts
- A bind mount mounts a file or directory on the host machine into a container.
	- Bind mounts are appropriate for the following types of use cases:
		- Sharing source code or build artifacts between a dev environment on the Docker host and a container
		- When you wan tto create or generate files in a container and persist the files onto the host's filesystem
- If you bind mount a file or directory into a directory in the container in which files or directories exist, the pre-existing files are obscured(not destroyed) by the mount.
## Underlying Technologies
### cgroups
[cgroups explained](https://www.youtube.com/watch?v=u1LeMndEk70)]
- cgroups
	- A kernel feature that allows to allocate and manage system resources
		- Subsystems/Controllers
		- Process/Tasks
	- Can inherit attributes from their parents
```
/sys/fs/cgroup/kubepods
tasks < PID
```
**Rules**:
- A single hierarchy can have one or more subsystems attached to it, but you can't attach the same subsystem twice
- Any single subsystem(such as cpu) cannot be attached to more than one hierarchy if one of those hierarchies has a different subsystem attached to it already
- For any single hierarchy you create, each task on the system can be a member of exactly one cgroup in that hierarchy. A single task may be in multipel groups as long as each of those cgroups is in a different hierarhcy.
- As soon as a task becomes a member of a second cgroup in the same hierarchy, it is removed from the first cgroup in tha thierarchy.
- At no time is a task ever in two different cgroups in the same hierarchy
### Namespaces
[Namespace Documentation - Docker](https://docs.docker.com/engine/security/userns-remap/)
[Namespace Documentation - Linus](https://www.linux.com/news/understanding-and-securing-linux-namespaces/)
- Linux namespaces provide isolation for running processes, limiting their access to system resources without the running process being aware of the limitations
### Union Filesystems
- A unique type of filesystem that creates a virtual, layered file structure by overlaying multiple directories
- Enables the simultaneous mounting of multiple directories on a single mount point while keeping their contents separate